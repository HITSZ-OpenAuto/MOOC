# 思政课程自动播放脚本使用教程

## 前提条件

- 推荐使用 Chrome 或 Edge 浏览器，因为它们可以直接在控制台中运行 JavaScript 代码
- Mac 用户可能可以直接拖动进度条（未经测试）

## 方法一：直接在控制台运行代码

请按照以下步骤操作：

1. 打开思政课程视频页面
2. 按 F12 键打开开发者工具
3. 切换到"Console"（控制台）标签
4. 复制粘贴以下代码到控制台中，然后按 Enter 键执行：

```javascript
(function(){
  // 获取当前视频信息
  const videoElement = document.getElementById('video-active');
  if (!videoElement) {
    alert('未找到视频元素，请确保您在视频播放页面');
    return;
  }
  
  // 获取课程ID和其他必要参数
  const urlParams = new URLSearchParams(window.location.search);
  const courseId = urlParams.get('id');
  
  if (!courseId) {
    alert('无法获取课程ID，请确保URL中包含id参数');
    return;
  }
  
  // 构建请求数据
  const data = {
    course_id: courseId,
    chapter_id: "0",  // 根据代码注释，没有章节时为0
    section_id: "0",  // 根据代码注释，没有节时为0
    current_time: videoElement.duration,  // 设置为视频总时长
    duration: videoElement.duration,
    state: 1  // 1表示已完成
  };
  
  // 发送请求标记为已完成
  $.ajax({
    url: "practice/saveUserCourseRecord",
    type: 'post',
    dataType: 'json',
    async: false,
    data: data,
    success: function(response) {
      alert('成功标记视频为已完成！');
      
      // 尝试查找并点击下一个视频链接
      const currentId = courseId;
      const courseLinks = Array.from(document.querySelectorAll('a[href*="coursedetail.html"]'));
      let foundCurrent = false;
      
      for (const link of courseLinks) {
        const linkId = new URLSearchParams(new URL(link.href, window.location.origin).search).get('id');
        
        if (linkId === currentId) {
          foundCurrent = true;
          continue;
        }
        
        if (foundCurrent) {
          alert('正在切换到下一个视频...');
          link.click();
          return;
        }
      }
      
      alert('已完成当前视频，但未找到下一个视频链接');
    },
    error: function(error) {
      alert('标记失败，错误信息: ' + JSON.stringify(error));
    }
  });
})();
```

**说明**：这段代码会直接在当前页面上运行，不需要安装任何插件。它会直接标记当前视频为已完成。每次打开新的视频页面时，您都需要重新运行这段代码。

## 方法二：创建浏览器书签（推荐）

如果你经常需要使用这个功能，可以将这段代码保存为浏览器书签，这样只需点击书签就能运行脚本。

### 创建书签步骤：

1. 首先，复制以下代码（这是经过特殊处理的版本，适合作为书签使用）：

```javascript
javascript:(function(){const e=document.getElementById("video-active");if(!e)return void alert("未找到视频元素，请确保您在视频播放页面");const t=new URLSearchParams(window.location.search).get("id");if(!t)return void alert("无法获取课程ID，请确保URL中包含id参数");const r={course_id:t,chapter_id:"0",section_id:"0",current_time:e.duration,duration:e.duration,state:1};$.ajax({url:"practice/saveUserCourseRecord",type:"post",dataType:"json",async:!1,data:r,success:function(e){alert("成功标记视频为已完成！");const r=t,a=Array.from(document.querySelectorAll('a[href*="coursedetail.html"]'));let o=!1;for(const e of a){const t=new URLSearchParams(new URL(e.href,window.location.origin).search).get("id");if(t===r){o=!0;continue}if(o)return void(alert("正在切换到下一个视频..."),e.click())}alert("已完成当前视频，但未找到下一个视频链接")},error:function(e){alert("标记失败，错误信息: "+JSON.stringify(e))}})})();
```

2. 在浏览器中，右键点击书签栏（如果看不到书签栏，按 Ctrl+Shift+B 显示它）
3. 选择"添加网页"或"添加页面..."选项
4. 在"名称"字段中，输入一个容易记住的名称，如"思政课自动播放"
5. 在"网址"字段中，粘贴上面的代码（以 javascript: 开头的那段）
6. 点击"保存"按钮

### 使用方法

现在，每当您访问思政课程视频页面时，只需点击这个书签，脚本就会自动运行，并直接标记视频为完成。您会看到一个提示框，确认脚本已经启动。
